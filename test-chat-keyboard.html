<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Keyboard Layout Test</title>
  <style>
    /* CSS Variables */
    :root {
      --keyboard-height: 0px;
    }
    
    body {
      margin: 0;
      font-family: -apple-system, system-ui, sans-serif;
    }
    
    /* Chat container styles from chat-simple.css */
    .chat-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: 100dvh;
      background: #f9fafb;
      transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Keyboard layout CSS */
    body.keyboard-visible .chat-container {
      bottom: var(--keyboard-height) !important;
      transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .chat-header {
      flex-shrink: 0;
      background: white;
      border-bottom: 1px solid #e5e7eb;
      z-index: 50;
      padding: 16px;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
      display: flex;
      flex-direction: column;
      padding: 16px;
    }
    
    body.keyboard-visible .chat-messages {
      max-height: calc(100% - 140px);
      overflow-y: auto;
    }
    
    .chat-input-area {
      flex-shrink: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 16px;
    }
    
    body.keyboard-visible .chat-input-area {
      position: relative;
      z-index: 10;
    }
    
    /* Test controls */
    .test-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      font-size: 14px;
    }
    
    .test-controls button {
      display: block;
      width: 100%;
      padding: 8px 12px;
      margin: 4px 0;
      border: none;
      background: #4f46e5;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }
    
    .test-controls button:hover {
      background: #4338ca;
    }
    
    .debug-info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 4px;
      font-size: 12px;
      z-index: 1000;
      max-width: 300px;
    }
    
    .debug-info div {
      margin: 2px 0;
    }
    
    .message {
      margin: 8px 0;
      padding: 12px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 24px;
      font-size: 16px;
      outline: none;
    }
    
    /* Visual indicators */
    .chat-container.debug-mode {
      outline: 3px solid red;
    }
    
    .chat-header.debug-mode {
      outline: 3px solid blue;
    }
    
    .chat-messages.debug-mode {
      outline: 3px solid green;
    }
    
    .chat-input-area.debug-mode {
      outline: 3px solid orange;
    }
  </style>
</head>
<body>
  <!-- Test Controls -->
  <div class="test-controls">
    <h4 style="margin: 0 0 10px 0;">Keyboard Test</h4>
    <button onclick="simulateKeyboard(300)">Show Keyboard (300px)</button>
    <button onclick="simulateKeyboard(350)">Show Keyboard (350px)</button>
    <button onclick="simulateKeyboard(400)">Show Keyboard (400px)</button>
    <button onclick="simulateKeyboard(0)">Hide Keyboard</button>
    <button onclick="toggleDebug()">Toggle Debug Mode</button>
    <button onclick="checkComputedStyles()">Check Styles</button>
  </div>
  
  <!-- Debug Info -->
  <div class="debug-info">
    <div><strong>Debug Info:</strong></div>
    <div>CSS Variable: <span id="cssVar">0px</span></div>
    <div>Body Class: <span id="bodyClass">none</span></div>
    <div>Container Bottom: <span id="containerBottom">0px</span></div>
    <div>Container Height: <span id="containerHeight">100vh</span></div>
    <div>Input Visible: <span id="inputVisible">yes</span></div>
  </div>
  
  <!-- Chat Container -->
  <div class="chat-container" id="chatContainer">
    <!-- Header -->
    <div class="chat-header">
      <h3 style="margin: 0;">Chat Test (Header Should Stay Fixed)</h3>
    </div>
    
    <!-- Messages -->
    <div class="chat-messages" id="chatMessages">
      <div class="message">Welcome to the chat keyboard test!</div>
      <div class="message">This tests if the chat container moves up when keyboard appears.</div>
      <div class="message">The header should stay at the top.</div>
      <div class="message">The input should move up with the keyboard.</div>
      <div class="message">Try different keyboard heights to test.</div>
      <div class="message">Message 6</div>
      <div class="message">Message 7</div>
      <div class="message">Message 8</div>
      <div class="message">Message 9</div>
      <div class="message">Message 10</div>
      <div class="message">Last message - you should be able to scroll to see this</div>
    </div>
    
    <!-- Input -->
    <div class="chat-input-area" id="chatInput">
      <input type="text" placeholder="Type a message..." id="textInput" />
    </div>
  </div>
  
  <script>
    let debugMode = false;
    
    function simulateKeyboard(height) {
      console.log(`Simulating keyboard height: ${height}px`);
      
      // Method 1: Direct DOM manipulation (what the hook does)
      document.documentElement.style.setProperty('--keyboard-height', `${height}px`);
      
      if (height > 0) {
        document.body.classList.add('keyboard-visible');
      } else {
        document.body.classList.remove('keyboard-visible');
      }
      
      // Method 2: Simulate postMessage (what native app does)
      const message = {
        type: 'keyboard_height_changed',
        payload: {
          height: height,
          visible: height > 0,
          duration: 250,
          easing: 'keyboard'
        }
      };
      window.postMessage(JSON.stringify(message), '*');
      
      updateDebugInfo();
    }
    
    function toggleDebug() {
      debugMode = !debugMode;
      const elements = ['chatContainer', 'chat-header', 'chatMessages', 'chatInput'];
      
      document.querySelectorAll('.chat-container, .chat-header, .chat-messages, .chat-input-area').forEach(el => {
        if (debugMode) {
          el.classList.add('debug-mode');
        } else {
          el.classList.remove('debug-mode');
        }
      });
    }
    
    function updateDebugInfo() {
      // CSS Variable
      const rootStyle = getComputedStyle(document.documentElement);
      const cssVarValue = rootStyle.getPropertyValue('--keyboard-height').trim() || '0px';
      document.getElementById('cssVar').textContent = cssVarValue;
      
      // Body class
      const hasClass = document.body.classList.contains('keyboard-visible');
      document.getElementById('bodyClass').textContent = hasClass ? 'keyboard-visible' : 'none';
      
      // Container computed styles
      const container = document.getElementById('chatContainer');
      const containerStyle = getComputedStyle(container);
      document.getElementById('containerBottom').textContent = containerStyle.bottom;
      document.getElementById('containerHeight').textContent = containerStyle.height;
      
      // Check if input is visible
      const input = document.getElementById('textInput');
      const inputRect = input.getBoundingClientRect();
      const isVisible = inputRect.bottom <= window.innerHeight && inputRect.top >= 0;
      document.getElementById('inputVisible').textContent = isVisible ? 'yes' : 'no';
    }
    
    function checkComputedStyles() {
      const container = document.getElementById('chatContainer');
      const styles = getComputedStyle(container);
      
      console.group('Computed Styles for .chat-container');
      console.log('position:', styles.position);
      console.log('bottom:', styles.bottom);
      console.log('transition:', styles.transition);
      console.log('transform:', styles.transform);
      console.log('height:', styles.height);
      console.groupEnd();
      
      const hasKeyboardClass = document.body.classList.contains('keyboard-visible');
      console.log('Body has keyboard-visible class:', hasKeyboardClass);
      console.log('CSS variable --keyboard-height:', getComputedStyle(document.documentElement).getPropertyValue('--keyboard-height'));
      
      alert(`Container bottom: ${styles.bottom}\nBody class: ${hasKeyboardClass ? 'keyboard-visible' : 'none'}\nCSS var: ${getComputedStyle(document.documentElement).getPropertyValue('--keyboard-height')}`);
    }
    
    // Listen for messages (simulate hook)
    window.addEventListener('message', (event) => {
      try {
        if (typeof event.data === 'string') {
          const data = JSON.parse(event.data);
          if (data.type === 'keyboard_height_changed') {
            console.log('Received keyboard message:', data.payload);
            // Hook would process this and update DOM
            // But we're already doing it in simulateKeyboard
          }
        }
      } catch (e) {
        // Ignore non-JSON messages
      }
    });
    
    // Update debug info regularly
    setInterval(updateDebugInfo, 500);
    
    // Initial update
    updateDebugInfo();
    
    // Focus handler
    document.getElementById('textInput').addEventListener('focus', () => {
      console.log('Input focused - in real app, this would trigger keyboard');
    });
  </script>
</body>
</html>